input {
  beats {
    port => 5044
  }
  tcp {
    port => 5000
    codec => json
  }
  udp {
    port => 5000
    codec => json
  }
}

filter {
  # Parse the timestamp field
  date {
    match => [ "timestamp", "ISO8601" ]
    target => "@timestamp"
  }

  # Mutate examples
  mutate {
    # Add new fields
    add_field => {
      "is_error" => "%{status_code >= 400}"
      "response_time_category" => "%{duration_ms >= 500 ? 'slow' : 'fast'}"
      "environment" => "production"
    }
  }

  mutate {
    # Convert duration_ms to integer
    convert => {
      "duration_ms" => "integer"
    }
  }

  mutate {
    # Add severity based on status code
    add_field => {
      "severity" => "%{status_code == 500 ? 'critical' : status_code >= 400 ? 'error' : 'info'}"
    }
  }

  mutate {
    # Remove unnecessary fields
    remove_field => ["@version", "host"]
  }

  # Add a new field combining user and action
  mutate {
    add_field => {
      "user_action" => "%{user} performed %{action}"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "logs-%{+YYYY.MM.dd}"
    document_type => "_doc"
  }
} 